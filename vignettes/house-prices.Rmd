---
title: "International House Prices"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In this exercise

```{r message=FALSE}
library(exuber)
options(exuber.show_progress = FALSE)
```


```{r}
library(dplyr)
```

# Download file 

```{r read data, message=FALSE}
dataURL <- "https://www.dallasfed.org/~/media/documents/institute/houseprice/hp1803.xlsx"
temp <- "hp.xlsx"
download.file(dataURL, destfile = temp, mode = 'wb')
rhpi <- readxl::read_excel(temp, sheet = 3)
```

```{r include=FALSE}
file.remove(temp)
```

# Wrangle

There are a couple of is

```{r Real House Price Index}
price <-
  rhpi %>%
  rename(Date = 1) %>%
  mutate(Date = Date %>% lubridate::yq()) %>%
  select( -25) %>% 
  tidyr::drop_na()
price
```


# Estimation 

```{r estimation}
radf_price <- 
  price %>% 
  radf(lag = 1)
```

```{r}
glimpse(radf_price)
```

# Critical Values

```{r monte_carlo, cache=TRUE}
# Monte Carlo
mc_con <- mc_cv(NROW(price), opt_bsadf = "conservative")
```

```{r sieve_boot, cache = TRUE}
# Sieve (Panel) Bootstrapped CV
sb <- sb_cv(price, lag = 1)
```

# Report

```{r report_tstat}
tibble(
  Country = col_names(radf_price),
  ADF = radf_price$adf,
  SADF = radf_price$sadf,
  GSADF = radf_price$gsadf
)
```

```{r report_cv}
tibble(
  Level = c("90%","95%","99%"),
  ADF = mc_con$adf_cv,
  SADF = mc_con$sadf_cv,
  GSADF = mc_con$gsadf_cv
)
```

# Panel

```{r panel}
summary(radf_price, sb)
```

# Plotting

```{r autoplot_radf, fig.width=9, fig.height=9}
radf_price %>%
  autoplot(mc_con, select = 1:9) %>%
  ggarrange(ncol = 3)
```

Alternatively we can gather all the individuals graphs and report only the periods of explosiveness.

```{r, fig.width=7, fig.height=5}
radf_price %>%
  datestamp(cv = mc_con) %>%
  autoplot()
```
